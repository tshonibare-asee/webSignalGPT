<!DOCTYPE html>
<html lang="en">
<head>
    <title>Signal-GPT</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/x-icon" href="assets/static/favicon/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" href="assets/static/favicon/favicon-152.png">
    <link rel="shortcut icon" sizes="192x192" href="assets/static/favicon/favicon-192.png">

    <meta name="mobile-web-app-capable" content="no">
    <meta name="apple-mobile-web-app-capable" content="no">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <meta itemprop="name" content="Signal-GPT">
    <meta itemprop="description" content="GPT tuned for RF: understands, classifies, and reasons over radio signals‚Äîand beyond.">
    <meta itemprop="image" content="/assets/static/share-image.jpg">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Caveat:700|Poppins:400,500,600,700" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <script src="bundle.js"></script>
    
    <style>
    /* Option 1: Minimalist Tech Header */
    .tech-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: linear-gradient(135deg, rgba(36, 36, 36, 0.95) 0%, rgba(24, 24, 48, 0.95) 100%);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        overflow: visible; /* Allow logo to extend beyond header bounds */
    }

    .tech-header.scrolled {
        background: linear-gradient(135deg, rgba(36, 36, 36, 0.98) 0%, rgba(24, 24, 48, 0.98) 100%);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }


/* Login Modal Styles */
    .login-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }

    .login-modal.active {
        display: flex;
    }

    .login-form {
        background: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
        padding: 3rem;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        width: 100%;
        max-width: 400px;
        position: relative;
    }

    .login-form__close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        font-size: 1.5rem;
        cursor: pointer;
        transition: color 0.3s ease;
    }

    .login-form__close:hover {
        color: white;
    }

    .login-form__title {
        color: white;
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 2rem;
        text-align: center;
        background: linear-gradient(135deg, #6a83ce, #4caf50);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .login-form__group {
        margin-bottom: 1.5rem;
    }

    .login-form__label {
        display: block;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 0.5rem;
        font-weight: 500;
    }

    .login-form__input {
        width: 100%;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        color: white;
        font-size: 1rem;
        transition: all 0.3s ease;
        box-sizing: border-box;
    }

    .login-form__input:focus {
        outline: none;
        border-color: #6a83ce;
        box-shadow: 0 0 20px rgba(106, 131, 206, 0.3);
    }

    .login-form__input::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }

    .login-form__button {
        width: 100%;
        padding: 1rem;
        background: linear-gradient(135deg, #6a83ce, #4caf50);
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
    }

    .login-form__button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(106, 131, 206, 0.4);
    }

    .login-form__button:active {
        transform: translateY(0);
    }



    .tech-header__container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        overflow: visible; /* Allow content to extend beyond container */
    }

    .tech-header__brand {
        display: flex;
        align-items: center;
        gap: 1rem;
        text-decoration: none;
        color: white;
        position: relative; /* For z-index control */
        z-index: 10; /* Ensure logo appears above other content */
    }

    .tech-header__logo {
        height: 50px; /* Increased size */
        width: auto;
        filter: brightness(1.1);
        position: relative;
        z-index: 11; /* Highest z-index for the logo */
        /* Optional: Add a subtle drop shadow to help it stand out */
        filter: brightness(1.1) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        transition: all 0.3s ease;
    }

    .tech-header__brand:hover .tech-header__logo {
        transform: scale(1.05); /* Slight scale on hover for interaction feedback */
    }

    .tech-header__title {
        font-family: 'Poppins', sans-serif;
        font-size: 1rem;
        font-weight: 300;
        color: #6a83ce;
        letter-spacing: -0.02em;
    }

    .tech-header__nav {
        display: flex;
        align-items: center;
        gap: 2rem;
    }

    .tech-header__link {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        position: relative;
        padding: 0.5rem 0;
    }

    .tech-header__link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: linear-gradient(90deg, #4F46E5, #7C3AED);
        transition: width 0.3s ease;
    }

    .tech-header__link:hover {
        color: white;
    }

    .tech-header__link:hover::after {
        width: 100%;
    }

    /* Add these styles to your existing <style> section */
.tech-header__cta {
    background: linear-gradient(135deg, #6a83ce, #4caf50);
    border: none;
    border-radius: 8px;
    color: white;
    padding: 0.5rem 1.2rem;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
}

.tech-header__cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(106, 131, 206, 0.4);
    background: linear-gradient(135deg, #5a73be, #3ca042);
}

.tech-header__cta:active {
    transform: translateY(0);
}

/* User info section styling when logged in */
.tech-header__user {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.tech-header__user-info {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
    font-weight: 500;
}

.tech-header__user-avatar {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, #6a83ce, #4caf50);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .tech-header__cta {
        padding: 0.4rem 1rem;
        font-size: 0.8rem;
    }
    
    .tech-header__user {
        gap: 0.5rem;
    }
    
    .tech-header__user-info {
        font-size: 0.8rem;
    }
    
    .tech-header__user-avatar {
        width: 28px;
        height: 28px;
        font-size: 0.8rem;
    }
}

    .tech-header__status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #10B981;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .tech-header__status::before {
        content: '';
        width: 8px;
        height: 8px;
        background: #10B981;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    .tech-header__mobile-toggle {
        display: none;
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
    }

    @media (max-width: 768px) {
        .tech-header__nav {
            display: none;
        }
        
        .tech-header__mobile-toggle {
            display: block;
        }
        
        .tech-header__container {
            padding: 1rem;
        }
        
        /* Scale down logo slightly on mobile to prevent overflow */
        .tech-header__logo {
            height: 55px;
        }
    }

    /* Remove the white space by eliminating body padding and adjusting wrapper margin */
    body {
        padding-top: 0 !important; /* Remove the body padding */
        margin: 0;
    }

    .wrapper {
        margin-top: 72px; /* Keep the same margin as before - header height unchanged */
    }

    /* Alternative approach - you can also target the intro section directly */
    .intro {
        padding-top: 0; /* Remove any existing padding */
    }

        /* Rainbow Glowing Text Effect */
    .intro__text {
        background: linear-gradient(
            45deg,
            #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3,
            #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3
        );
        background-size: 200% 200%;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: rainbow-glow 3s ease-in-out infinite;
        /* No glow effects */
    }

    @keyframes rainbow-glow {
        0%, 100% {
            background-position: 0% 50%;
            filter: 
                drop-shadow(0 0 15px rgba(255, 255, 255, 0.3))
                drop-shadow(0 0 25px rgba(255, 0, 0, 0.4));
        }
        25% {
            background-position: 25% 50%;
            filter: 
                drop-shadow(0 0 15px rgba(255, 255, 255, 0.3))
                drop-shadow(0 0 25px rgba(255, 255, 0, 0.4));
        }
        50% {
            background-position: 50% 50%;
            filter: 
                drop-shadow(0 0 15px rgba(255, 255, 255, 0.3))
                drop-shadow(0 0 25px rgba(0, 255, 0, 0.4));
        }
        75% {
            background-position: 75% 50%;
            filter: 
                drop-shadow(0 0 15px rgba(255, 255, 255, 0.3))
                drop-shadow(0 0 25px rgba(0, 0, 255, 0.4));
        }
    }

    /* Fallback for browsers that don't support background-clip: text */
    @supports not (-webkit-background-clip: text) {
        .intro__text {
            color: #fff;
            text-shadow: 
                0 0 10px rgba(255, 0, 0, 0.8),
                0 0 20px rgba(255, 127, 0, 0.6),
                0 0 30px rgba(255, 255, 0, 0.6),
                0 0 40px rgba(0, 255, 0, 0.6),
                0 0 50px rgba(0, 0, 255, 0.6),
                0 0 60px rgba(75, 0, 130, 0.6),
                0 0 70px rgba(148, 0, 211, 0.6);
        }
    }

    .login-form[data-mode="login"] .only-signup { display: none; }
    .login-form[data-mode="signup"] .only-login { display: none; }


    </style>
</head>



<!-- Firebase Auth Script -->
<script type="module">
  // 1) Firebase SDK imports (modular)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getAuth, onAuthStateChanged, setPersistence,
    browserLocalPersistence, // change to browserSessionPersistence or inMemoryPersistence if you like
    createUserWithEmailAndPassword, signInWithEmailAndPassword,
    signOut, updateProfile, sendEmailVerification
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  // 2) Your Firebase config (replace with your values from Firebase console)
  // Your web app's Firebase configuration. For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig  = {
    apiKey: "AIzaSyBmYxWBOFK9ynF7OcCTp42r4zEf9QMmZVQ",
    authDomain: "signalgpt-acdda.firebaseapp.com",
    projectId: "signalgpt-acdda",
    storageBucket: "signalgpt-acdda.firebasestorage.app",
    messagingSenderId: "933280263439",
    appId: "1:933280263439:web:a066f5b1de36512a10627a",
    measurementId: "G-ZP6VLKNTEM"
  };

  // 3) Initialize Firebase + Auth
  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  await setPersistence(auth, browserLocalPersistence); // persists across browser restarts

  // 4) Small helpers
  const $ = (sel) => document.querySelector(sel);
  const toast = (msg, kind="info") => {
    const el = Object.assign(document.createElement("div"), { textContent: msg });
    el.style.cssText = `
      position:fixed;top:100px;right:20px;padding:1rem 2rem;border-radius:10px;
      color:#fff;font-weight:600;z-index:10001;opacity:0;transform:translateX(100%);
      transition:all .3s ease;`;
    el.style.background =
      kind==="success" ? "linear-gradient(135deg,#4caf50,#45a049)" :
      kind==="error"   ? "linear-gradient(135deg,#f44336,#da190b)" :
                         "linear-gradient(135deg,#6a83ce,#4caf50)";
    document.body.appendChild(el);
    setTimeout(()=>{el.style.opacity=1;el.style.transform="translateX(0)";},50);
    setTimeout(()=>{el.style.opacity=0;el.style.transform="translateX(100%)";setTimeout(()=>el.remove(),300);},3000);
  };
  const nameFromEmail = (email) => email.split("@")[0];

  // 5) Hook up your modal & form
  const authForm   = $("#auth-form");      // container with data-mode="login" | "signup"
  const loginModal = $("#login-modal");
  const loginForm  = $("#login-form-element");
  const toggleAuth = $("#toggle-auth");
  const submitBtn  = $("#submit-btn");
  const loginBtn   = $("#login-btn");
  const closeBtn   = $("#close-login");
  const logoutBtn  = $("#logout-btn");

  // Open modal in LOGIN mode
  loginBtn?.addEventListener("click", () => {
    authForm.dataset.mode = "login";
    submitBtn.textContent = "Log in";
    $("#auth-title").textContent = "Log in to SignalGPT";
    loginModal.classList.add("active");
  });
  // Close modal
  closeBtn?.addEventListener("click", ()=> loginModal.classList.remove("active"));
  loginModal?.addEventListener("click",(e)=>{ if(e.target===loginModal) loginModal.classList.remove("active"); });
  document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") loginModal.classList.remove("active"); });

  // Toggle signup/login
  toggleAuth?.addEventListener("click",(e)=>{
    e.preventDefault();
    const next = authForm.dataset.mode==="login" ? "signup" : "login";
    authForm.dataset.mode = next;
    submitBtn.textContent = next==="login" ? "Log in" : "Sign up";
    $("#auth-title").textContent = next==="login" ? "Log in to SignalGPT" : "Create your SignalGPT account";
  });

  // 6) Submit handler (Sign up or Log in)
  loginForm?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const mode        = authForm.dataset.mode;
    const email       = $("#email").value.trim().toLowerCase();
    const displayName = ($("#displayName")?.value || "").trim();
    const password    = $("#password").value;
    const confirm     = $("#confirm")?.value;

    try {
      if (mode === "signup") {
        if (password.length < 8) throw new Error("Use at least 8 characters.");
        if (password !== confirm) throw new Error("Passwords do not match.");

        // Create the account
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        // Set a displayName for header/avatar (falls back to email prefix)
        await updateProfile(cred.user, { displayName: displayName || nameFromEmail(email) });
        // Optional: send verification email
        try { await sendEmailVerification(cred.user); } catch {}
        toast("Account created! Check your email for verification.", "success");
      } else {
        // Log in
        await signInWithEmailAndPassword(auth, email, password);
      }
      loginModal.classList.remove("active");
      loginForm.reset();
    } catch (err) {
      // Map common Firebase auth errors to friendly messages
      const code = err?.code || "";
      const msg =
        code === "auth/email-already-in-use"    ? "That email is already registered." :
        code === "auth/invalid-email"           ? "Please enter a valid email." :
        code === "auth/weak-password"           ? "Please choose a stronger password." :
        code === "auth/user-not-found"          ? "No account found for that email." :
        code === "auth/wrong-password"          ? "Incorrect password." :
        code === "auth/too-many-requests"       ? "Too many attempts. Try again later." :
        err.message || "Authentication error";
      toast(msg, "error");
      console.error(err);
    }
  });

  // 7) Sign out
  logoutBtn?.addEventListener("click", async () => {
    await signOut(auth);
    toast("Signed out", "info");
  });

  // 8) Reflect auth state in your header UI (avatar + username)
  const userInfo     = $("#user-info");
  const loginSection = $("#login-section");
  const userName     = $("#user-name");
  const userAvatar   = $("#user-avatar");

  // Optional: make a per-login session ID (separate from Firebase tokens)
  function makeSessionId() {
    const sid = crypto.randomUUID();
    localStorage.setItem("signalgpt_session_id", sid);
    return sid;
  }

  onAuthStateChanged(auth, (user) => {
    if (user) {
      const display = user.displayName || nameFromEmail(user.email || "");
      userInfo.style.display = "flex";
      loginSection.style.display = "none";
      userName.textContent = `Welcome, ${display}`;
      userAvatar.textContent = display.charAt(0).toUpperCase();
      userAvatar.title = user.email || "";

      // Create/refresh your own per-login session id (optional)
      if (!localStorage.getItem("signalgpt_session_id")) makeSessionId();

      // If you ever need a stable unique ID for the user, use user.uid
      // Access/ID tokens are handled by Firebase behind the scenes
    } else {
      userInfo.style.display = "none";
      loginSection.style.display = "flex";
      localStorage.removeItem("signalgpt_session_id");
    }
  });
</script>

<script type="module">
// After your existing Firebase setup‚Ä¶
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const auth = getAuth();

// Reuse your existing iframe code:
const CHAT_URL = "http://localhost:8004/";
const DIAGRAM_URL = "http://localhost:8003/";
const BLOCKS_URL  = "http://localhost:8006/";

let chatEventSource = null;

//function startChatStream(uid) {
//  if (chatEventSource) chatEventSource.close();
//  chatEventSource = new EventSource(`http://127.0.0.1:8004/chat_stream?uid=${encodeURIComponent(uid)}`);
  // (keep the same onmessage/onerror handlers you already have)
//}

// === Parent ‚Üí Child auth handoff (reply to iframes that ask) ===
const ALLOWED_ORIGINS = new Set([
  new URL(CHAT_URL).origin,
  new URL(DIAGRAM_URL).origin,
  new URL(BLOCKS_URL).origin
]);

window.addEventListener("message", (ev) => {
  // Only answer explicit auth requests from our iframes
  if (!ev.data || ev.data.type !== "signalgpt-auth-request") return;
  if (!ALLOWED_ORIGINS.has(ev.origin)) return; // drop anything unexpected

  const authInfo = window.__SIGNALGPT__;
  if (authInfo?.uid) {
    ev.source?.postMessage(
      { type: "signalgpt-auth", uid: authInfo.uid, idToken: authInfo.idToken },
      ev.origin
    );
  } else {
    // (optional) tell child there‚Äôs no user yet
    ev.source?.postMessage(
      { type: "signalgpt-auth", error: "not-logged-in" },
      ev.origin
    );
  }
});



function setChatIframe(uid) {
  const iframe = document.querySelector('#output-container_iframe iframe');
  if (iframe) {
    const url = `${CHAT_URL}?uid=${encodeURIComponent(uid)}`;
    if (iframe.src !== url) iframe.src = url;
  }
}

onAuthStateChanged(auth, async (user) => {
  if (user) {
    const idToken = await user.getIdToken();     // save if you need to POST /prompt
    window.__SIGNALGPT__ = { uid: user.uid, idToken };

    // Update the eval/inference iframe with credentials
    const inf = document.querySelector('#inference-container_iframe iframe');
    if (inf) {
    const ORIGIN_8002 = "http://localhost:8002";

    // Easiest: reload with uid/idToken in the URL
    inf.src = `${ORIGIN_8002}/?uid=${encodeURIComponent(user.uid)}&idToken=${encodeURIComponent(idToken)}`;

    // Also proactively postMessage so it works without a reload
    try {
        inf.contentWindow?.postMessage(
        { type: "signalgpt-auth", uid: user.uid, idToken },
        ORIGIN_8002
        );
    } catch {}
    }




    setChatIframe(user.uid);                     // <-- pass uid into chat iframe
    //startChatStream(user.uid);                   // <-- watch only this uid
  } else {
    window.__SIGNALGPT__ = null;
    if (chatEventSource) { chatEventSource.close(); chatEventSource = null; }
    // Optional: blank out the chat iframe if signed out
    const iframe = document.querySelector('#output-container_iframe iframe');
    if (iframe) iframe.src = CHAT_URL;

    // Also reset the Eval/Inference iframe when signed out
    const inf = document.querySelector('#inference-container_iframe iframe');
    if (inf) {
    const ORIGIN_8002 = "http://localhost:8002";
    // Clear any previous uid/idToken in the URL
    inf.src = `${ORIGIN_8002}/`;
    // Proactively notify eval.html to drop auth and show "Waiting for user prompt"
    try { inf.contentWindow?.postMessage({ type: "signalgpt-logout" }, ORIGIN_8002); } catch {}
    }

  }
});
</script>





<body class="no-scroll">

    <!-- Login Modal -->
    <div id="login-modal" class="login-modal">
        <div class="login-form" id="auth-form" data-mode="login">
            <button class="login-form__close" id="close-login">&times;</button>
            <h2 class="login-form__title" id="auth-title">Welcome to SignalGPT</h2>
            <form id="login-form-element">
            <div class="login-form__group">
                <label for="email" class="login-form__label">Email</label>
                <input type="email" id="email" name="email" class="login-form__input" placeholder="you@domain.com" required>
            </div>

            <div class="login-form__group only-signup">
                <label for="displayName" class="login-form__label">Display name (shown in header)</label>
                <input type="text" id="displayName" name="displayName" class="login-form__input" placeholder="e.g., Tayo">
            </div>

            <div class="login-form__group">
                <label for="password" class="login-form__label">Password</label>
                <input type="password" id="password" name="password" class="login-form__input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            </div>

            <div class="login-form__group only-signup">
                <label for="confirm" class="login-form__label">Confirm password</label>
                <input type="password" id="confirm" name="confirm" class="login-form__input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>

            <button type="submit" class="login-form__button" id="submit-btn">Log in</button>

            <p style="margin-top:1rem;text-align:center;color:rgba(255,255,255,.8)">
                <span class="only-login">Don‚Äôt have an account?</span>
                <span class="only-signup">Already have an account?</span>
                <a href="#" id="toggle-auth" style="font-weight:600;">SignUp</a>
            </p>
            </form>
        </div>
        </div>





    <!-- Option 1: Minimalist Tech Header -->
    <header class="tech-header" id="tech-header">
        <div class="tech-header__container">
            <a href="https://www.allseeingtech.ca/" class="tech-header__brand">
                <img src="assets/AllSeeingTransparentLogo.png" alt="AllSeeing" class="tech-header__logo">
                <span class="tech-header__title">SignalGPT</span>
            </a>
            
            <!-- User info section (shown when logged in) -->
            <div id="user-info" class="tech-header__user" style="display: none;">
                <span id="user-name" class="tech-header__user-info">Welcome, User</span>
                <div id="user-avatar" class="tech-header__user-avatar">U</div>
                <button id="logout-btn" class="tech-header__cta">Logout</button>
            </div>
            
            <!-- Login button (shown when not logged in) -->
            <div id="login-section" class="tech-header__nav">
                <button id="login-btn" class="tech-header__cta">Login</button>
            </div>
        </div>
    </header>



    <script>
        // Header scroll effect
        window.addEventListener('scroll', () => {
            const header = document.getElementById('tech-header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
    </script>








    
    <div class="wrapper">
        <div class="intro">
            <div class="intro__sharing">
                <a href="https://www.linkedin.com/company/all-seeing/" class="intro__share-link intro__share-link--linkedin"></a>
                
            </div>
            <div class="intro__inner">
                <h1 class="intro__title"><span class="hidden-text"> Signal-GPT</span><img
                    src="assets/Signal_GPT_Logo.jpg" alt="" class="intro__title-image intro__title-image--desktop"><img src="assets/Signal_GPT_Logo.jpg" alt="" class="intro__title-image intro__title-image--mobile"></h1>
                    <span class="intro__content-desktop">
                        <p class="intro__text">The world's first Large Language Model (LLM)<span class="intro__text-break"> </span> for processing radio signals - and much more!</p>
                        <div class="intro__cta">
                            <a href="#" class="button button--large button--color-blue" id="start-tutorial-button">
                                <span class="button__content">
                                    <span class="icon icon--speaker">
                                    </span>
                                    Let's Go!
                                </span>
                            </a>
                            <p class="wizard__launch-skip-paragraph">or <a href="#" class="link wizard__launch-skip" id="skip-tutorial-button">skip the tutorial</a></p>
                            <p class="wizard__browser-warning">Sorry, your browser doesn't support the latest technologies. <br>Download <a class="link" href="https://www.google.com/chrome/browser/desktop/index.html" target="_blank">Google Chrome</a> to use this and other experiments.</p>
                        </div>
                    </span>
                    <span class="intro__content-mobile" id="is-compatible">
                        <p class="font__weight--semi-bold intro__content-mobile-header">Mobile version <br>is highly experimental.</p>
                        <p class="intro__content-mobile-body">If you're new to machine learning, visit the site on a desktop for a helpful first-time tutorial and better performance.</p>
                        <p class="intro__content-mobile-ok">
                            <a href="#" class="link font__weight--semi-bold intro__content-mobile-ok-link"
                            id="skip-tutorial-button-mobile">GOT IT</a>
                        </p>
                    </span>
                    <span class="intro__content-mobile-incompatible" id="is-not-compatible">
                        Sorry, looks like your browser or device doesn't support this experiment. Learn more about
                        SignalGPT <a href="https://allseeingtech.ca" target="_blank" class="link">here.</a> Or try visiting this site on a desktop
                        computer in a
                        browser like Chrome.
                    </span>
                </div>
                <div class="intro__footer" style="bottom: 5%;">
                    <a href="https://www.allseeingtech.ca/" target="_blank" class="link intro__footer-link--left"><img
                        src="./assets/footer-intro_allseeing.png" class="intro__footer-image"
                        alt="From yourfriends at AllSeeing"></a>
                        <a href="https://www.allseeingtech.ca/privacy-and-terms" target="_blank" class="link link--grey intro__footer-link--right">Privacy &amp; Terms</a>
                    </div>
                </div>

                <div class="machine" id="machine">
                    <div class="machine__sections" style="align-items:center;justify-content: center;">
                        <div id="input-section" class="section" style="flex-basis:550px;margin:0px;">
                            <h1 class="section__title"><span>SIGNAL DISPLAY</span></h1>
                            
                            <div class="section__container" style="min-width:350px">
                                <!--<h3 class="section__title"><span>VECTOR PLOT</span></h3>-->
                                <div class="input__media" style="background-color:#fff;width:100%">
                                    <div id="wf-container" style="height:100%;">
                                        <div id="wf-container_iframe"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    <div class="wires wires--left"></div>

                    <div id="learning-section">
                        <h2 class="section__title section__title--learning"><span>AI TASKING</span></h2>
                        
                        <div class="section__container" style="width:350px">
                            <div class="input__media" style="background-color: #fff;height:450px;">
                                <div id="inference-container" style="display:block;height:100%;">
                                    <div id="inference-container_iframe"></div>
                                </div>
                            </div> 
                        </div>
     
                        <div id="green" class="learning__class" style="display:none"></div>
                        <div id="purple" class="learning__class" style="display:none"></div>
                        <div id="orange" class="learning__class" style="display:none"></div>

                    </div>


                    <div class="wires wires--disabled wires--right">
                        <?xml version="1.0" encoding="utf-8"?>
                        <!-- Generator: Adobe Illustrator 19.2.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
                        <svg version="1.1" class="wires-svg" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        viewBox="0 0 323 77.6" style="enable-background:new 0 0 323 77.6;" xml:space="preserve">
                        <filter id="blur-filter" x="-2" y="-2" width="100" height="100">
                          <feGaussianBlur in="SourceGraphic" stdDeviation="3" />
                      </filter>
                      <style type="text/css">
                      .st0{fill:none;stroke:#CED1D2;stroke-width:3;stroke-miterlimit:10;}
                      .st1{fill:#F38759;}
                      .st2{fill:#C174AE;}
                      .st3{fill:#5EB84E;}
                  </style>
                  <path class="st0 wire--right-green" d="M75.1,69.4C75.1,29.3,1.5,64.2,1.5,0"/>
                  <line class="st0 wire--right-purple" x1="161.5" y1="69.4" x2="161.5" y2="0"/>
                  <path class="st0 wire--right-orange" d="M248.5,69.4c0-40.1,73-5.2,73-69.4"/>
                  <path class="st3 wire--right-bulb-green" d="M83.9,73.8v3.8H66.3v-3.8c0-2.4,1.9-4.3,4.3-4.3h9C82,69.4,83.9,71.4,83.9,73.8z"/>
                  <path class="st2 wire--right-bulb-purple" d="M170.3,73.8v3.8h-17.6v-3.8c0-2.4,1.9-4.3,4.3-4.3h9C168.4,69.4,170.3,71.4,170.3,73.8z"/>
                  <path class="st1 wire--right-bulb-orange" d="M257.3,73.8v3.8h-17.6v-3.8c0-2.4,1.9-4.3,4.3-4.3h9C255.4,69.4,257.3,71.4,257.3,73.8z"/>
                  <path class="st3 wire--right-bulb-green-glow" d="M83.9,73.8v3.8H66.3v-3.8c0-2.4,1.9-4.3,4.3-4.3h9C82,69.4,83.9,71.4,83.9,73.8z"/>
                  <path class="st2 wire--right-bulb-orange-glow" d="M170.3,73.8v3.8h-17.6v-3.8c0-2.4,1.9-4.3,4.3-4.3h9C168.4,69.4,170.3,71.4,170.3,73.8z"/>
                  <path class="st1 wire--right-bulb-purple-glow" d="M257.3,73.8v3.8h-17.6v-3.8c0-2.4,1.9-4.3,4.3-4.3h9C255.4,69.4,257.3,71.4,257.3,73.8z"/>
              </svg>
          </div>


          <div id="output-section" class="section" style="flex-basis:400px;margin:0px;">
            <h2 class="section__title"><span>ACTION LOG</span></h2>
            
            <div class="section__container">
                
                <!--This is in place of the section title-->
                <div class="output__controls">
                    <div class="output__selector-wrapper" style="display:flex; gap:16px; cursor:pointer; user-select:none;">
                        <div id="tab-chat" class="tab is-active">Chat<span class="notification-dot"></span></div>
                        <div id="tab-diagram" class="tab">Diagram<span class="notification-dot"></span></div>
                        <div id="tab-blocks" class="tab">Blocks</div>
                    </div>
                </div>
                <div class="divider" style="margin:2px;"></div>
                <style>
                    .output__selector-wrapper .tab{ padding:4px 10px; border-radius:8px; position:relative; }
                    .output__selector-wrapper .tab.is-active{ background:#eef2ff; font-weight:600; }
                    
                    /* Notification dot styles */
                    .tab .notification-dot {
                        position: absolute;
                        top: -4px;
                        right: -4px;
                        width: 16px;
                        height: 16px;
                        background-color: #ff3333;
                        border-radius: 50%;
                        border: 2px solid white;
                        box-shadow: 0 2px 8px rgba(255, 51, 51, 0.5);
                        display: none;
                        animation: shake-pulse 1.5s infinite;
                        z-index: 10;
                    }
                    
                    .tab .notification-dot.show {
                        display: block;
                    }
                    
                    @keyframes shake-pulse {
                        0% { 
                            transform: scale(1) translateX(0); 
                            opacity: 1; 
                        }
                        10% { 
                            transform: scale(1.1) translateX(-1px); 
                            opacity: 1; 
                        }
                        20% { 
                            transform: scale(1.1) translateX(1px); 
                            opacity: 0.9; 
                        }
                        30% { 
                            transform: scale(1.1) translateX(-1px); 
                            opacity: 1; 
                        }
                        40% { 
                            transform: scale(1.1) translateX(1px); 
                            opacity: 0.9; 
                        }
                        50% { 
                            transform: scale(1.1) translateX(0); 
                            opacity: 1; 
                        }
                        60% { 
                            transform: scale(1.2) translateX(0); 
                            opacity: 0.8; 
                        }
                        70% { 
                            transform: scale(1.1) translateX(0); 
                            opacity: 1; 
                        }
                        100% { 
                            transform: scale(1) translateX(0); 
                            opacity: 1; 
                        }
                    }
                </style>

                
                

                <div class="output__media" style="background-color: #fff;">
                    <div id="output-container"  style="height:100%;padding:5px;">
                        <div id="output-container_iframe"></div>
                    </div>
                </div> 




            </div>
        </div>


    </div>
</div>


<div class="wizard__wrapper" style="background:#242424;">
    <div class="wizard" id="wizard" style="background: #242424;">
        <div class="wizard__inner" style="background: #242424;"></div>
    </div>
</div>

<div class="faq-record-container">
    <div class="faq" style="display:flex;gap:150px;align-items:flex-start;justify-content:center;">

        <div class="faq__inner">
            <h3 class="faq__question">‚ùì What is SignalGPT?</h3>
            <p class="faq__answer" style="text-align:justify;">
                <p style="text-align:justify;"> SignalGPT is your AI co-pilot for the world of signals. Built by
                <strong>AllSeeing</strong>, it understands, reasons, and helps you design
                RF, audio, sonar, radar, and LiDAR signal processors.
                Think of it as ChatGPT - only tuned for engineers, researchers, and innovators
                working with complex signal chains.
            </p>
            </p>
            
            <h3 class="faq__question">‚ö° What kind of things can you do with SignalGPT?</h3>
            <p class="faq__answer" style="text-align:justify;"><p>With SignalGPT you can:</p>
                <ul style="text-align:justify;">
                    <li><strong>Build Software Defined Radios instantly</strong> &mdash; Describe your system in English, and get a functional SDR to test and deploy.</li>
                    <li><strong>Prototype faster</strong> &mdash; Move from concept to running signal-chain in minutes instead of days.</li>
                    <li><strong>Visualize clearly</strong> &mdash; Auto-generate multi-domain signal processing systems (i.e., radar, sonar, lidar, etc).</li>
                    <li><strong>Experiment with signals</strong> &mdash; Generate tones, connect sources and sinks, run PSDs, and explore "what-if" scenarios without a single code.</li>
                    <li><strong>Collaborate easily</strong> &mdash; Share diagrams and signal workflows with your team, funding partners, or customers.</li>
                </ul></p>
            
            </div>

        <div class="faq__inner">
            <h3 class="faq__question">üí° Tips to get the most out of SignalGPT</h3>
            <p class="faq__answer" style="text-align:justify;">
                <ul style="text-align:justify;" ><li><strong>Be descriptive</strong> &mdash; The more detail you provide about frequencies, sinks, or protocols, the more precise your flow diagram will be.</li>
                    <li><strong>Iterate quickly</strong> &mdash; Don't wait for perfection. Generate, test, and refine‚ÄîSignalGPT is built for fast cycles.</li>
                    <li><strong>Think modular</strong> &mdash; Break big systems into sources, processors, and sinks. SignalGPT thrives on modular design thinking.</li>
                    <li><strong>Stay curious</strong> &mdash; SignalGPT can show you both the "textbook" setup <em>and</em> unexpected new ideasfor exploring signals.</li>
                </ul>
            </p>
            
            <h3 class="faq__question" style="text-align:justify;">‚öôÔ∏è How was this built and who made this?</h3>
            <p class="faq__answer" style="text-align:justify;">
                 <p style="text-align:justify;">SignalGPT was built by AllSeeing, a Canadian-born innovator creating
                    dual-use sensing technologies. Our team blends expertise in RF, photonics, AI, and advanced prototyping &mdash;supported by Canada's innovation ecosystem.
                </p>
            </p>
        
            <footer class="footer">
                <a href="https://www.allseeingtech.ca/" target="_blank" class="link"><img class="footer__image" style="width:100%;" src="./assets/footer-intro_allseeing_white.png" alt="From your friends at Allseeing"></img></a>
                <a href="https://www.allseeingtech.ca/privacy-and-terms" target="_blank" class="link link--privacy">Privacy &amp; Terms</a>
            </footer>

        
        </div>


    </div>
</div>





</div>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107306747-1"></script>
<script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments)}; gtag('js', new Date()); gtag('config', 'UA-107306747-1'); </script>
<script type="text/javascript">

    function getAndroidVersion() {
        var ua = (navigator.userAgent).toLowerCase();
        var match = ua.match(/android\s([0-9\.]*)/);
        return match ? parseInt(match[1], 10) : false;
    }

    if (
        (navigator.userAgent.indexOf('MSIE') > -1) ||
        (navigator.userAgent.indexOf('Trident') > -1) ||
        (navigator.userAgent.indexOf('Edge') > -1)||
        !(
            typeof document.querySelector('.wizard__browser-warning').classList === 'object' &&
            typeof document.querySelector('.wizard__browser-warning').classList.forEach === 'function'
        )) {
        document.querySelector('.wizard__browser-warning').style.display = 'block';
    document.querySelector('.wizard__launch-skip-paragraph').style.display = 'none';
    document.getElementById('start-tutorial-button').style.display = 'none';
    document.getElementById('is-compatible').style.display = 'none';
}
if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)
    || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) {

    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia ||
        (getAndroidVersion() && getAndroidVersion() < 7)) {
        document.getElementById('is-not-compatible').style.display = 'block';
        document.getElementById('is-compatible').style.display = 'none';
    }
}
</script>

<script>
    (function () {
    // Your standalone Signal Channel 1 page:
    const WF_PAGE_URL = "http://localhost:8000/";  // Signal Channel A iframe 

    const host = document.getElementById("wf-container_iframe");
    host.innerHTML = ""; // clear any placeholders

    const iframe = document.createElement("iframe");
    iframe.src = WF_PAGE_URL;
    iframe.title = "Waterfall";
    iframe.setAttribute("frameborder", "0");
    iframe.setAttribute("scrolling", "no");
    iframe.style.cssText = [
        "display:flex",
        "width:100%",
        "height:100%",   // will fill the container
        "border:0",
        "margin:0",
        "padding:0",
        "background:transparent",
        "pointer-events:none",   // <- blocks all interaction
        "user-select:none"       // optional: prevents text selection drag
    ].join(";");

    // Make the container act as a fixed viewport for the embed
    host.style.cssText += ";position:relative;overflow:hidden;width:100%;height:100%;margin:0;padding:0;border:0";

    host.appendChild(iframe);
    })();
</script>


<!--<script>
    (function () {
    // Your standalone power spectrum page:
    const WF_PAGE_URL = "http://localhost:8001/";  // Channel B iframe

    const host = document.getElementById("psd-container_iframe");
    host.innerHTML = ""; // clear any placeholders

    const iframe = document.createElement("iframe");
    iframe.src = WF_PAGE_URL;
    iframe.title = "Power Spectrum";
    iframe.setAttribute("frameborder", "0");
    iframe.setAttribute("scrolling", "no");
    iframe.style.cssText = [
        "display:flex",
        "width:100%",
        "height:100%",   // will fill the container
        "border:0",
        "margin:0",
        "padding:0",
        "background:transparent",
        "pointer-events:none",   // <- blocks all interaction
        "user-select:none"       // optional: prevents text selection drag
    ].join(";");

    // Make the container act as a fixed viewport for the embed
    host.style.cssText += ";position:relative;overflow:hidden;width:100%;height:100%;margin:0;padding:0;border:0";

    host.appendChild(iframe);
    })();
</script>-->


<script>
    (function () {
    // Eval / Inference iframe
    const INF_URL = "http://localhost:8002/";
    const host = document.getElementById("inference-container_iframe");
    host.innerHTML = "";

    const iframe = document.createElement("iframe");

    // If already logged in, pass auth via URL so eval.html can start immediately
    const u  = window.__SIGNALGPT__?.uid || "";
    const tk = window.__SIGNALGPT__?.idToken || "";
    iframe.src = u ? `${INF_URL}?uid=${encodeURIComponent(u)}&idToken=${encodeURIComponent(tk)}`
                    : INF_URL;

    iframe.title = "Inference Display";
    iframe.setAttribute("frameborder", "0");
    iframe.setAttribute("scrolling", "no");
    iframe.style.cssText = [
        "display:block","width:100%","height:100%","border:0","margin:0","padding:0","background:transparent"
    ].join(";");
    host.style.cssText += ";position:relative;overflow:hidden;width:100%;height:100%;margin:0;padding:0;border:0";
    host.appendChild(iframe);
    })();
</script>





<script>
(function () {
  // Configure your endpoints here:
  const CHAT_URL    = "http://localhost:8004/";   // existing Chat iframe
  const DIAGRAM_URL = "http://localhost:8003/";   // Diagram iframe (change to your IP:port)
  const BLOCKS_URL  = "http://localhost:8006/";   // Blocks iframe (change to your IP:port)

  const host = document.getElementById("output-container_iframe");
  host.classList.add("allow-scroll");
  host.innerHTML = "";

  // Create a single iframe we will reuse
  const iframe = document.createElement("iframe");
  iframe.title = "Output Display";
  iframe.setAttribute("frameborder", "0");
  iframe.setAttribute("scrolling", "no");
  iframe.style.cssText = [
    "display:flex","width:100%","height:100%",
    "border:0","margin:0","padding:0","background:transparent",
    "pointer-events:auto","touch-action:auto"
  ].join(";");
  // fixed viewport for the embed
  host.style.cssText += ";position:relative;overflow:hidden;width:100%;height:100%;margin:0;padding:0;border:0";
  host.appendChild(iframe);

  // Tab elements
  const tabChat    = document.getElementById("tab-chat");
  const tabDiagram = document.getElementById("tab-diagram");
  const tabBlocks  = document.getElementById("tab-blocks");

  function setActive(tabEl){
    document.querySelectorAll(".output__selector-wrapper .tab").forEach(el => el.classList.remove("is-active"));
    tabEl.classList.add("is-active");
  }

  function loadOutput(url){
    // Only swap if different to avoid reload jitter
    if (iframe.src !== url) iframe.src = url;
  }

  function chatUrl() {
    const u = window.__SIGNALGPT__?.uid;
    return u ? `${CHAT_URL}?uid=${encodeURIComponent(u)}` : CHAT_URL;
    }

  // Wire up clicks
  tabChat.addEventListener("click",    () => { 
    setActive(tabChat);    
    loadOutput(chatUrl());
    // Clear chat notification when user views chat
    clearNotification('chat');
  });
  tabDiagram.addEventListener("click", () => { 
    setActive(tabDiagram); 
    const uid = window.__SIGNALGPT__?.uid || "";
    loadOutput(`${DIAGRAM_URL}?uid=${encodeURIComponent(uid)}`);
    // Clear diagram notification when user views diagram
    clearNotification('diagram');
  });
  tabBlocks.addEventListener("click",  () => { 
    setActive(tabBlocks);  
    loadOutput(BLOCKS_URL);  
    });

    // let mermaid/eval/chat ask for auth if they need it
    window.addEventListener("message", (ev) => {
    if (ev.data && ev.data.type === "signalgpt-auth-request" && window.__SIGNALGPT__?.uid) {
        ev.source?.postMessage(
        { type:"signalgpt-auth", uid: window.__SIGNALGPT__.uid, idToken: window.__SIGNALGPT__.idToken },
        ev.origin || "*"
        );
    }
    });


  // Default to Chat (current behavior)
  setActive(tabChat);
  loadOutput(chatUrl());
  clearNotification('chat');


  // Notification system for chat stream monitoring
  let lastSeenChatId = 0;
  let lastSeenDiagramId = 0;

  function showNotification(type) {
    const tabElement = type === 'chat' ? tabChat : tabDiagram;
    const notificationDot = tabElement.querySelector('.notification-dot');
    if (notificationDot) {
      notificationDot.classList.add('show');
    }
  }

  function clearNotification(type) {
    const tabElement = type === 'chat' ? tabChat : tabDiagram;
    const notificationDot = tabElement.querySelector('.notification-dot');
    if (notificationDot) {
      notificationDot.classList.remove('show');
    }
  }

  // Monitor chat stream for new messages
    function connectToChatStream() {
    try {
        const uid = window.__SIGNALGPT__?.uid;
        if (!uid) {
        // not logged in yet; try again shortly
        setTimeout(connectToChatStream, 2000);
        return;
        }

        // Prefer the same host/port as CHAT_URL
        const base = (typeof CHAT_URL === "string" ? CHAT_URL : "http://127.0.0.1:8004/").replace(/\/$/, "");
        const eventSource = new EventSource(`${base}/chat_stream?uid=${encodeURIComponent(uid)}`);

        eventSource.onmessage = function (event) {
        try {
            const data = JSON.parse(event.data);

            if (data.role === 'assistant' && data.id > lastSeenChatId) {
            lastSeenChatId = data.id;
            if (!tabChat.classList.contains('is-active')) showNotification('chat');
            }

            if (data.image && data.image.includes('/media?') && data.id > lastSeenDiagramId) {
            lastSeenDiagramId = data.id;
            if (!tabDiagram.classList.contains('is-active')) showNotification('diagram');
            }
        } catch (parseError) {
            console.log('Error parsing chat stream data:', parseError);
        }
        };

        eventSource.onerror = function (error) {
        console.log('Chat stream connection error:', error);
        // Attempt to reconnect after 5 seconds
        setTimeout(connectToChatStream, 5000);
        };
    } catch (error) {
        console.log('Failed to connect to chat stream:', error);
        setTimeout(connectToChatStream, 5000);
    }
    }


  // Start monitoring the chat stream
  connectToChatStream();

  // Keep your scroll-unblocker so the iframe can scroll/handle input
  const unblock = (e) => {
    if (e.target && e.target.closest(".allow-scroll")) e.stopImmediatePropagation();
  };
  ["wheel","mousewheel","touchmove"].forEach(t => {
    document.addEventListener(t, unblock, { capture: true, passive: false });
  });
})();
</script>






<script>
(function () {
  // Reusable overlay (same as before)
  function ensureOverlay() {
    let overlay = document.getElementById("promoted-image-overlay");
    if (!overlay) {
      overlay = document.createElement("div");
      overlay.id = "promoted-image-overlay";
      overlay.innerHTML = `
        <div class="pio-backdrop"></div>
        <figure class="pio-figure">
          <img class="pio-img" alt="">
          <figcaption class="pio-caption"></figcaption>
          <button class="pio-close" aria-label="Close">√ó</button>
        </figure>
      `;
      const style = document.createElement("style");
      style.textContent = `
        #promoted-image-overlay{position:fixed;inset:0;display:none;z-index:9999}
        #promoted-image-overlay.show{display:block}
        #promoted-image-overlay .pio-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px)}
        #promoted-image-overlay .pio-figure{pointer-events: auto;position:absolute; inset:4vmin; margin:0;display:grid;grid-template-rows: 1fr auto;justify-items: center;align-items: center;align-content: center;gap:.75rem;}
        #promoted-image-overlay .pio-img{display:block; max-width:100%;max-height:100%;object-fit:contain; align-self:center;justify-self:center;box-shadow:0 10px 30px rgba(0,0,0,.35);border-radius:10px;background:#fff;}
        #promoted-image-overlay .pio-caption{color:#e5e7eb;font:13px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;text-align:center;word-break:break-word}
        #promoted-image-overlay .pio-close{position:absolute;top:8px;right:12px;border:0;background:transparent;color:#fff;font-size:32px;line-height:1;cursor:pointer;text-shadow:0 1px 4px rgba(0,0,0,.6)}
      `;
      overlay.appendChild(style);
      document.body.appendChild(overlay);
      
      
      const close = () => overlay.classList.remove("show");
      
      // Keep these if you like explicit targets:
      overlay.querySelector(".pio-close").addEventListener("click", close);
      window.addEventListener("keydown", (e) => { if (e.key === "Escape") close(); });
      
      // ‚úÖ Close on ANY click that isn't the image (works even if backdrop isn't the target)
      overlay.addEventListener("click", (e) => {
        if (e.target.closest(".pio-img")) return; // don't close when clicking the image itself
        close();
    }, { capture: true });
    
    //Optional: also handle taps
    overlay.addEventListener("touchstart", (e) => {
        if (e.target.closest(".pio-img")) return;
        close();
    }, { capture: true, passive: true });

    }
    return overlay;
  }

  function showImage(src, altText) {
    if (!src) return;
    const overlay = ensureOverlay();
    overlay.querySelector(".pio-img").src = src;
    overlay.querySelector(".pio-img").alt = altText || "";
    overlay.querySelector(".pio-caption").textContent = altText || "";
    overlay.classList.add("show");
  }

  // Listen for messages from the iframe
  window.addEventListener("message", function (event) {
    // Optional: restrict by origin for security, e.g.:
    // if (event.origin !== "http://localhost:8004") return;

    const data = event.data || {};
    if (data && data.type === "promote-image") {
      showImage(data.src, data.alt);
    }
  });

  // Reply to auth requests from child iframes (e.g., eval.html)
window.addEventListener("message", (ev) => {
  if (ev?.data?.type === "signalgpt-auth-request" && window.__SIGNALGPT__?.uid) {
    ev.source?.postMessage(
      {
        type: "signalgpt-auth",
        uid: window.__SIGNALGPT__.uid,
        idToken: window.__SIGNALGPT__.idToken
      },
      ev.origin || "*"
    );
  }
});



})();
</script>











</body>
</html>